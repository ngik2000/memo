# Instruction Set
https://llvm.org/docs/WritingAnLLVMBackend.html#instruction-set

第5パラメータは、アセンブリ・プリンタで使用される文字列で、アセンブリ・プリンタ・インターフェースが実装されるまでは空の文字列のままでよい。最後の6番目のパラメータは、「The LLVM Target-Independent Code Generator」で説明したSelectionDAGの選択フェーズで、命令のマッチングに使用されるパターンである。このパラメータは、次のセクション「命令セレクタ」で詳しく説明します。

インストラクションクラスの定義は、異なるオペランドタイプに対してオーバーロードされないため、レジスタ、メモリ、即値のオペランドには別バージョンのインストラクションが必要です。例えば，即値オペランドからレジスタへのWordのLoad Integer命令を実行するには，次のような命令クラスが定義されます。

似たような命令が多いため、このような定義を書くのはカット＆ペーストが多くなります。.tdファイルでは，multiclass指示文により，複数の命令クラスを一度に定義するテンプレートを作成することができます（defm指示文を使用）．例えば、SparcInstrInfo.tdでは、マルチクラスパターンF3_12が定義されており、F3_12が起動されるたびに2つの命令クラスが生成されます。

したがって、defm指令をXOR命令とADD命令に使用すると、以下のように4つの命令オブジェクトが作成されます。XORrr、XORri、ADDrr、ADDriの4つの命令オブジェクトが作成されます。

SparcInstrInfo.tdには、分岐命令で参照される条件コードの定義も含まれています。SparcInstrInfo.tdの以下の定義は、SPARCの条件コードのビット位置を示しています。例えば、10 ビット目は整数の「より大きい」条件を、22 ビット目は浮動小数点の「より大きい」条件を表します。

(なお、Sparc.hでは同じSPARC条件コードに対応するenumも定義されています。Sparc.hの値とSparcInstrInfo.tdの値が対応していることを確認するように注意してください。例えば、SPCC::ICC_NE = 9、SPCC::FCC_U = 23など）。

# Instruction Operand Mapping
命令オペランドのマッピング
コード・ジェネレータ・バックエンドは、命令のオペランドを命令内のフィールドにマッピングします。オペランドは、定義された順に、命令の結合されていないフィールドに割り当てられます。フィールドは、値が割り当てられるとバインドされます。たとえば、Sparc ターゲットでは、XNORrr 命令を 3 つのオペランドを持つ F3_1 フォーマットの命令として定義しています。

SparcInstrFormats.tdの命令テンプレートでは、F3_1のベースクラスはInstSPとなっています。

InstSPは、opフィールドを拘束しません。

F3は、opフィールドを結合し、rd、op3、rs1フィールドを定義します。F3フォーマット命令は、オペランドのrd、op3、rs1フィールドを束ねる。

F3_1は、op3フィールドをバインドし、rs2フィールドを定義します。F3_1フォーマット命令は、オペランドをrd、rs1、rs2の各フィールドにバインドします。この結果、XNORrr命令は、$dst、$b、および$cのオペランドをそれぞれrd、rs1、およびrs2フィールドにバインドします。

